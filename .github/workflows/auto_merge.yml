name: Merge branch on commit

on:
  push:
    branches:
      - '*'
      - '!/main'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Merge branches
        run: |
          # Récupère la liste des branches enfants
          branches=$(git branch --list '*' --no-color --no-column --contains)

          # Pour chaque branche enfant
          for branch in $branches; do
            # Vérifie les modifications apportées à la branche enfant
            git checkout $branch
            git merge --no-ff --no-edit master

            # Si la branche enfant contient des modifications non présentes dans la branche principale
            if ! git diff --quiet master; then
              # Met à jour la branche principale avec les modifications de la branche enfant
              git checkout master
              git merge --no-ff --no-edit $branch
              git push origin master
            fi
          done
